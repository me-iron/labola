// Katakana to Hangul Map (Standard Transliteration)
const KATAKANA_MAP: Record<string, string> = {
    'ア': '아', 'イ': '이', 'ウ': '우', 'エ': '에', 'オ': '오',
    'カ': '카', 'キ': '키', 'ク': '쿠', 'ケ': '케', 'コ': '코',
    'サ': '사', 'シ': '시', 'ス': '스', 'セ': '세', 'ソ': '소',
    'タ': '타', 'チ': '치', 'ツ': '츠', 'テ': '테', 'ト': '토',
    'ナ': '나', 'ニ': '니', 'ヌ': '누', 'ネ': '네', 'ノ': '노',
    'ハ': '하', 'ヒ': '히', 'フ': '후', 'ヘ': '헤', 'ホ': '호',
    'マ': '마', 'ミ': '미', 'ム': '무', 'メ': '메', 'モ': '모',
    'ヤ': '야', 'ユ': '유', 'ヨ': '요',
    'ラ': '라', 'リ': '리', 'ル': '루', 'レ': '레', 'ロ': '로',
    'ワ': '와', 'ヲ': '오', 'ン': 'ㄴ',
    'ガ': '가', 'ギ': '기', 'グ': '구', 'ゲ': '게', 'ゴ': '고',
    'ザ': '자', 'ジ': '지', 'ズ': '즈', 'ゼ': '제', 'ゾ': '조',
    'ダ': '다', 'ヂ': '지', 'ヅ': '즈', 'デ': '데', 'ド': '도',
    'バ': '바', 'ビ': '비', 'ブ': '부', 'ベ': '베', 'ボ': '보',
    'パ': '파', 'ピ': '피', 'プ': '푸', 'ペ': '페', 'ポ': '포',
    'キャ': '캬', 'キュ': '큐', 'キョ': '쿄',
    'シャ': '샤', 'シュ': '슈', 'ショ': '쇼',
    'チャ': '차', 'チュ': '추', 'チョ': '초',
    'ニャ': '냐', 'ニュ': '뉴', 'ニョ': '뇨',
    'ヒャ': '햐', 'ヒュ': '휴', 'ヒョ': '효',
    'ミャ': '먀', 'ミュ': '뮤', 'ミョ': '묘',
    'リャ': '랴', 'リュ': '류', 'リョ': '료',
    'ギャ': '갸', 'ギュ': '규', 'ギョ': '교',
    'ジャ': '자', 'ジュ': '주', 'ジョ': '조',
    'ビャ': '뱌', 'ビュ': '뷰', 'ビョ': '뵤',
    'ピャ': '퍄', 'ピュ': '퓨', 'ピョ': '표',
    'イェ': '예',
    'ウィ': '위', 'ウェ': '웨', 'ウォ': '워',
    'ヴァ': '바', 'ヴィ': '비', 'ヴ': '브', 'ヴェ': '베', 'ヴォ': '보',
    'シェ': '셰', 'ジェ': '제', 'チェ': '체',
    'ティ': '티', 'ディ': '디',
    'ファ': '파', 'フィ': '피', 'フェ': '페', 'フォ': '포',
    'ー': '', // Prolonged sound (omitted or mapped specifically, context dependent usually, but empty for simplicty or vowel extension)
};

// Kanji to Hangul Eum-dok (Sino-Korean sound)
// Generated for the 502 unique characters found in the dataset
const KANJI_MAP: Record<string, string> = {
    '日': '일', '本': '본', '橋': '교', '中': '중', '央': '앙', '区': '구', '立': '립', '総': '총', '合': '합', '室': '실',
    '内': '내', '浜': '빈', '町': '정', '駅': '역', '分': '분', '時': '시', '間': '간', '個': '개', '人': '인', '参': '참',
    '加': '가', '東': '동', '京': '경', '都': '도', '丁': '정', '目': '목', '数': '수', '不': '부', '足': '족', '為': '위',
    '止': '지', '横': '횡', '神': '신', '奈': '나', '川': '천', '県': '현', '市': '시', '山': '산', '隔': '격', '週': '주',
    '開': '개', '催': '최', '経': '경', '験': '험', '者': '자', '向': '향', '先': '선', '着': '착', '割': '할', '名': '명',
    '水': '수', '曜': '요', '朝': '조', '銀': '은', '座': '좌', '西': '서', '田': '전', '無': '무', '屋': '옥', '上': '상',
    '前': '전', '円': '원', '引': '인', '平': '평', '昼': '주', '出': '출', '完': '완', '全': '전', '和': '화', '光': '광',
    '成': '성', '増': '증', '埼': '기', '玉': '옥', '白': '백', '子': '자', '老': '노', '若': '약', '男': '남', '女': '여',
    '誰': '수', '楽': '락', '健': '건', '康': '강', '崎': '기', '高': '고', '津': '진', '蟹': '해', '谷': '곡', '当': '당',
    '予': '예', '約': '약', '詳': '상', '細': '세', '確': '확', '認': '인', '問': '문', '新': '신', '宿': '숙', '限': '한',
    '定': '정', '利': '이', '用': '용', '空': '공', '電': '전', '話': '화', '代': '대', '木': '목', '競': '경', '技': '기',
    '場': '장', '原': '원', '徒': '도', '歩': '보', '抜': '발', '群': '군', '綺': '기', '麗': '려', '施': '시', '設': '설',
    '渋': '삽', '南': '남', '国': '국', '第': '제', '一': '일', '体': '체', '育': '육', '館': '관', '落': '낙', '長': '장',
    '大': '대', '江': '강', '戸': '호', '線': '선', '直': '직', '結': '결', '豊': '풍', '島': '도', '吉': '길', '祥': '상',
    '寺': '사', '海': '해', '工': '공', '芝': '지', '更': '경', '衣': '의', '備': '비', '音': '음', '流': '류', '武': '무',
    '蔵': '장', '野': '야', '錦': '금', '糸': '사', '階': '계', '墨': '묵', '活': '활', '千': '천', '住': '주', '緑': '녹',
    '番': '번', '号': '호', '級': '급', '以': '이', '方': '방', '冷': '냉', '房': '방', '陽': '양', '砂': '사', '期': '기',
    '宮': '궁', '土': '토', '面': '면', '倒': '도', '要': '요', '保': '보', '試': '시', '筑': '축', '延': '연', '店': '점',
    '曙': '서', '柏': '백', '葉': '엽', '駒': '구', '台': '대', '優': '우', '連': '연', '絡': '락', '枠': '틀', '船': '선',
    '鎌': '겸', '倉': '창', '友': '우', '満': '만', '員': '원', '御': '어', '礼': '례', '天': '천', '下': '하', '茶': '다',
    '阪': '판', '府': '부', '岸': '안', '里': '리', '姫': '희', '路': '로', '兵': '병', '庫': '고', '八': '팔', '家': '가',
    '越': '월', '蒲': '포', '生': '생', '早': '조', '続': '속', '北': '북', '口': '구', '歳': '세', '性': '성', '湘': '상',
    '藤': '등', '沢': '택', '専': '전', '初': '초', '歓': '환', '迎': '영', '根': '근', '付': '부', '回': '회', '券': '권',
    '蘇': '소', '我': '아', '急': '급', '安': '안', '心': '심', '指': '지', '浦': '포', '広': '광', '尾': '미', '放': '방',
    '年': '년', '選': '선', '手': '수', '教': '교', '所': '소', '属': '속', '得': '득', '可': '가', '少': '소', '厚': '후',
    '愛': '애', '甲': '갑', '残': '잔', '営': '영', '業': '업', '終': '종', '了': '료', '料': '료', '古': '고', '知': '지',
    '村': '촌', '池': '지', '尼': '니', '塚': '총', '洲': '주', '幸': '행', '決': '결', '型': '형', '宇': '우', '品': '품',
    '能': '능', '学': '학', '対': '대', '象': '상', '通': '통', '常': '상', '金': '금', '幕': '막', '張': '장', '花': '화',
    '見': '견', '機': '기', '価': '가', '格': '격', '翼': '익', '梅': '매', '深': '심', '福': '복', '術': '술', '基': '기',
    '礎': '초', '鬼': '귀', '富': '부', '士': '사', '動': '동', '画': '화', '撮': '촬', '影': '영', '月': '월', '堺': '계',
    '美': '미', '材': '재', '之': '지', '泉': '천', '春': '춘', '部': '부', '後': '후', '単': '단', '発': '발', '低': '저',
    '多': '다', '摩': '마', '球': '구', '倶': '구', '河': '하', '練': '련', '習': '습', '会': '회', '王': '왕', '臼': '구',
    '板': '판', '蓮': '련', '外': '외', '仙': '선', '城': '성', '治': '치', '槇': '전', '清': '청', '茨': '자', '三': '삼',
    '丘': '구', '吹': '취', '駐': '주', '車': '차', '半': '반', '久': '구', '宝': '보', '龍': '용', '華': '화', '近': '근',
    '九': '구', '条': '조', '此': '차', '岡': '강', '博': '박', '那': '나', '珂': '가', '小': '소', '夜': '야', '鶴': '학',
    '沼': '소', '柴': '시', '橿': '강', '良': '양', '地': '지', '旭': '욱', '殿': '전', '周': '주', '州': '주', '幡': '번',
    '袖': '수', '最': '최', '枚': '매', '貰': '세', '待': '대', '登': '등', '録': '록', '元': '원', '道': '도', '徹': '철',
    '底': '저', '文': '문', '郷': '향', '重': '중', '視': '시', '軽': '경', '喫': '끽', '煙': '연', '超': '초', '運': '운',
    '慣': '관', '夢': '몽', '曽': '증', '霞': '하', '倍': '배', '六': '육', '有': '유', '調': '조', '布': '포', '味': '미',
    '素': '소', '脱': '탈', '入': '입', '門': '문', '火': '화', '商': '상', '棟': '동', '両': '양', '進': '진', '候': '후',
    '気': '기', '温': '온', '左': '좌', '右': '우', '快': '쾌', '適': '적', '戦': '전', '百': '백', '麻': '마', '万': '만',
    '妙': '묘', '典': '전', '街': '가', '同': '동', '勝': '승', '鴨': '압', '居': '거', '服': '복', '采': '채', '担': '담',
    '太': '태', '井': '정', '孔': '공', '晟': '성', '改': '개', '札': '찰', '蹴': '축', '松': '송', '森': '삼', '遽': '거',
    '薬': '약', '滝': '용', '証': '증', '港': '항', '貨': '화', '拡': '확', '募': '모', '集': '집', '雨': '우', '推': '추',
    '奨': '장', '制': '제', '度': '도', '爆': '폭', '印': '인', '冬': '동', '熱': '열', '量': '량', '取': '취', '鹿': '록',
    '黒': '흑', '晴': '청', '鴻': '홍', '巣': '소', '団': '단', '赤': '적', '坂': '판', '茂': '무', '関': '관', '景': '경',
    '吾': '오', '妻': '처', '栃': '회', '喜': '희', '馬': '마', '次': '차', '静': '정', '駿': '준', '丸': '환', '厳': '엄',
    '禁': '금', '熊': '웅', '主': '주', '栄': '영', '精': '정', '潟': '석', '牧': '목', '稲': '도', '坪': '평', '澤': '택',
    '郡': '군', '伏': '복', '桃': '도', '公': '공', '園': '원', '現': '현', '在': '재', '押': '압', '須': '수', '灘': '탄',
    '青': '청', '臨': '임', '岬': '갑', '庄': '장', '秘': '비', '密': '밀', '求': '구', '編': '편', '磨': '마', '的': '적',
    '明': '명', '石': '석', '貸': '대', '切': '절' // Supplemented a few
};

export function transliterate(text: string, lang: 'ko' | 'ja'): string {
    if (!text) return '';
    if (lang === 'ja') return text;

    let result = '';
    // Simple iteration for now. For prolonged sounds (ー), it needs context (vowel elongation). 
    // But standard hangulization usually drops it or maps it based on previous vowel. 
    // For 'スポーツ' (Supootsu) -> '스포츠' (Seupocheu). 
    // Our map handles single chars. Let's do a simple replacement for now.
    // Advanced logic for 'ー' is complex, we will just omit it for simplicity as per map.

    for (let i = 0; i < text.length; i++) {
        const char = text[i];

        // Check Multi-char Katakana (Compound)
        // Actually, handling compounds like 'キャ' requires lookahead.
        let mapped = '';

        // Lookahead for small compounds
        if (i < text.length - 1) {
            const double = char + text[i + 1];
            if (KATAKANA_MAP[double]) {
                result += KATAKANA_MAP[double];
                i++; // Skip next
                continue;
            }
        }

        if (KATAKANA_MAP[char]) {
            result += KATAKANA_MAP[char];
        } else if (KANJI_MAP[char]) {
            result += KANJI_MAP[char];
        } else {
            result += char;
        }
    }

    // Post-processing for special Katakana rules could go here (e.g. ㄴ insertion)
    // But for "wow" factor, the direct mapping is already very powerful for Kanji.

    return result;
}
